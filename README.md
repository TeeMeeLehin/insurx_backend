# InsurX Backend

This is the backend API for the InsurX application, built with Node.js, Express, TypeScript, and Prisma.

## Project Structure

The project follows a standard TypeScript structure:

```
backend/
├── src/                # Source code (TypeScript)
│   ├── config/         # Environment and app configuration
│   ├── controllers/    # Request handlers (business logic)
│   ├── middleware/     # Custom middleware (auth, error handling)
│   ├── routes/         # API route definitions
│   ├── app.ts          # Express application setup
│   └── server.ts       # Server entry point
├── dist/               # Compiled code (JavaScript) - Generated by build
├── prisma/             # Database schema and migrations
├── package.json        # Dependencies and scripts
└── tsconfig.json       # TypeScript configuration
```

### `src` vs `dist`

- **`src/`**: This folder contains the source code written in **TypeScript** (`.ts` files). This is where development happens.
- **`dist/`**: This folder contains the compiled **JavaScript** (`.js` files). Node.js runs the code from this folder in production.
  - When you run `npm run build`, the TypeScript compiler (`tsc`) reads files from `src/` and transpiles them into JavaScript in `dist/`.
  - **`src/app.ts`** compiles to **`dist/app.js`**.
  - **`src/server.ts`** compiles to **`dist/server.js`**.

## Getting Started

### Prerequisites

- Node.js (v18+ recommended)
- npm

### Installation

1. Navigate to the backend directory:
   ```bash
   cd backend
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Set up environment variables:
   - Create a `.env` file in the root of `backend/`.
   - Add necessary variables (PORT, DATABASE_URL, JWT_SECRET, etc.).

### Running the Server

- **Development Mode**:
  Runs the server with `nodemon` and `ts-node` for hot-reloading.
  ```bash
  npm run dev
  ```

- **Production Build**:
  Compiles TypeScript to JavaScript and runs the compiled code.
  ```bash
  npm run build
  npm start
  ```

## Configuration & Environment

The application relies on environment variables defined in a `.env` file (see `src/config/env.ts` for defaults).

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Port server listens on | `4000` |
| `DATABASE_URL` | Connection string for Prisma | *Required* |
| `JWT_SECRET` | Secret key for signing tokens | `supersecretkey` |
| `NODE_ENV` | Environment (`development` / `production`) | `development` |

### Database (Prisma)

This project uses [Prisma](https://www.prisma.io/) as the ORM.

1. **Schema**: The database model is defined in `prisma/schema.prisma`.
2. **Setup**:
   - Install dependencies: `npm install`
   - Generate Prisma Client: `npx prisma generate` (Runs automatically after install)
   - Push schema to DB (Dev): `npx prisma db push`
3. **Database URL**:
   Set `DATABASE_URL` in your `.env` file.
   - Example (SQLite): `file:./dev.db`
   - Example (Postgres): `postgresql://user:password@localhost:5432/mydb?schema=public`

**Note**: The current setup defaults to `sqlite` in `prisma/schema.prisma`. To use PostgreSQL or MySQL, update the `provider` in the `datasource` block of `schema.prisma`.

## Key Components

- **`server.ts`**: The entry point. It imports the configured Express app from `app.ts`, connects to the database, and starts the HTTP server.
- **`app.ts`**: Configures the Express application, applies middleware (CORS, Helmet, Morgan), and registers routes.
- **`routes/`**: Defines the API endpoints (e.g., `/api/auth`, `/api/payment`) and maps them to controller functions.
- **`controllers/`**: Contains the logic for processing requests and returning responses.

## API Endpoints

- **Auth**: `/api/auth` (Login, Register)
- **Payment**: `/api/payment`
- **Risk**: `/api/risk`
- **Predictions**: `/api/predictions`
